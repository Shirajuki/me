<!doctype html>
<html>
  <head>
    <title>SnakeIsBoss</title>
    <meta charset="utf-8" />
    <style>
      canvas {background: lightgray;}
      body {
        display: flex;
        justify-content: center;
      }
      div {
        display: block;
        left: 50%;
        text-align: center;
        width: 30%;
      }
      .slider {
        -webkit-appearance: none;
        height: 10px;
        border-radius: 5px;
        background: #d3d3d3;
        outline: none;
        opacity: 0.7;
        -webkit-transition: .2s;
        transition: opacity .2s;
        width: 50%;
      }
      .slider:hover {
        opacity: 1;
      }
      .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 17px;
        height: 17px;
        border-radius: 50%;
        background: black;
        cursor: pointer;
      }
      p {
        display: flex;
        justify-content: center;
      }
      input {
        background-color: #eee;
        border: 0;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
 <body>
  <canvas id="myCanvas" width="600" height="600"></canvas>
  <script>
  // canvas related vars
  window.onload = oppstart;
  var canvas = document.getElementById("myCanvas");
  var ctx = canvas.getContext("2d");
  let frameSpeed = 5; //5
  var cd = frameSpeed;
  var snakeSize = 20;
  var padding = 10;
  let slider;
  let snake = [
    {x: 170, y: 150},
    {x: 150, y: 150},
    {x: 130, y: 150},
    {x: 110, y: 150},
    {x: 90, y: 150},
  ];
  let dx = 0, dy = 0;
  let foodX = 0, foodY = 0;
  let fruits = [];
  var left = false, right = false, down = false; up = false;
  function oppstart() {
    createFood();
    draw();
    slider = document.getElementById("slider");
  }
  document.addEventListener("keydown", keyDownHandler, false);
  function keyDownHandler(e) {
    if(e.keyCode == 37 && !right) {
      resetKey();
      left = true;
    }
    else if(e.keyCode == 38 && !down) {
      resetKey();
      up = true;
    }
    else if(e.keyCode == 39 && !left) {
      resetKey();
      right = true;
    }
    else if(e.keyCode == 40 && !up) {
      resetKey();
      down = true;
    }
  }
  function resetKey() {
    left = false;
    up = false;
    down = false;
    right = false;
  }
  function getRndInteger(min, max) {
    return Math.floor(Math.random() * (max - min + 1) ) + min;
  }
  function createFood() {
    foodX = getRndInteger(1,(canvas.width-2*padding)/20) * 20 - 10;
    foodY = getRndInteger(1,(canvas.height-2*padding-20)/20) * 20 - 10;
    for (var i = 0; i < snake.length; i++) {
      if (snake[i].x === foodX && snake[i].y === foodY) {
        createFood();
      }
    }
    fruits[0] = ({x: foodX, y: foodY});
  }
  function drawObject(object,cFill,cStroke,width,height,type = 0) {
    ctx.fillStyle = cFill;
    ctx.strokeStyle = cStroke;
    if (type == 0) {
      ctx.fillRect(object.x, object.y, width, height);
    }
    ctx.strokeRect(object.x, object.y, width, height);
  }
  function reset() {
    snake = [
      {x: 170, y: 150},
      {x: 150, y: 150},
      {x: 130, y: 150},
      {x: 110, y: 150},
      {x: 90, y: 150},
    ];
    resetKey();
    resetMove();
  }
  function upSnake() {
    let snakeee = snake[0];
    let head = {x: snakeee.x + dx, y: snakeee.y+dy};
    //console.log(head.x, head.y)
    for (var i = 0; i < snake.length; i++) {
      if (head.x === snake[i].x && head.y === snake[i].y) {
        reset();
        return
      }
      if (head.x > canvas.width-2*padding-10 || head.x < padding || head.y < padding || head.y > canvas.height-2*padding-10-20) {
        if (document.getElementById("wall").checked == true) {
          reset();
          return
        }
        else {
          if (head.x > canvas.width-2*padding) {
            head.x = padding;
          }
          else if (head.x < padding) {
            head.x = canvas.width-2*padding-10;
          }
          else if (head.y < padding) {
            head.y = canvas.height-2*padding-10-20;
          }
          else if (head.y > canvas.height-2*padding-10-20) {
            head.y = padding;
          }
        }
      }
    }
    snake.unshift(head);
    if (snake[0].x === foodX && snake[0].y === foodY) {
      createFood()
    } else {
      snake.pop();
    }
  }
  function resetMove() {
    dx = 0;
    dy = 0;
  }
  function updateText() {
    document.getElementById("text").innerHTML = (slider.value)*-1;
  }
  function drawScore() {
    ctx.beginPath();
    ctx.font = "bold 15px Arial";
  	ctx.fillStyle = "black";
    ctx.textAlign = "center";
  	ctx.fillText("Score: "+snake.length, canvas.width-100,canvas.height-10);
    ctx.closePath();
  }
  function draw() {
    if (cd == 0) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (var i = 0; i < snake.length; i++) {
        let snakes = snake[i];
        drawObject(snakes,document.getElementById("farge1").value,document.getElementById("farge2").value,snakeSize,snakeSize);
      }
      for (var i = 0; i < fruits.length; i++) {
        let fruit = fruits[i];
        drawObject(fruit,document.getElementById("farge3").value,document.getElementById("farge4").value,snakeSize,snakeSize);
      }
      drawScore()
      if (left) {
        resetMove();
        dx = -snakeSize;
        upSnake();
      }
      else if (up) {
        resetMove();
        dy = -snakeSize;
        upSnake();
      }
      else if (right) {
        resetMove();
        dx = snakeSize;
        upSnake();
      }
      else if (down) {
        resetMove();
        dy = snakeSize;
        upSnake();
      }
      drawObject({x:padding,y:padding},'black','black',canvas.width-2*padding,canvas.height-2*padding-20,1);
      cd = slider.value*-1;
    }
    else {
      cd--;
    }
    requestAnimationFrame(draw);
  }
  </script>
  <div>
    <h3>UPDATE TIMER: <span id="text">5</span></h3>
    <span>SLOW <input type="range" min="-10" max="-1" value="-5" class="slider" id="slider" onchange="updateText()"> FAST</span><br/>
    <h3><input type="checkbox" id="wall"/> YES_WALL</h3>
    <p><span>SNAKE COLOR:<br/>
    <input title="FillColor" type="color" id="farge1" value="#FF00FF">
    <input title="StrokeColor" type="color" id="farge2" value="#000000">
    </span>
    <span>&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span>FRUIT COLOR:<br/>
    <input title="FillColor" type="color" id="farge3" value="#ffaaaa">
    <input title="StrokeColor" type="color" id="farge4" value="#ff0000">
    </span>
    </p>
  </div>
 </body>
</html>
